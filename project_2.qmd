# Miniproject: maintaining a healthy microbiome

## Mini description

Microbes often form intricate relationships, not only amongst each other, but also with larger organisms from all kingdoms: plants, animals, and fungi. While they often provide useful services, microbes typically evolve much faster than these hosts. What stops a microbe from taking advantage of its host, taking more resources than it provides, or even damaging the host tissue to gain access to even more resources? The latter scenario, we would call a pathogen, and the likelyhood of this transition from occuring could be called the **disease pressure**. 

Understanding the fundamental principles behind disease pressure can help mitigating disease outbreaks. For example, if we understand the conditions under which a microbe is likely to become a pathogen, we can take steps to prevent this from happening. 

![Parasitism-mutualism continuum of host-associated microbes. Note that this is a cartoon, and that nature is in almost all cases more complicated than this. ](images/mutpar_continuum.png){#fig-parmut}

To phrase the above story a little differently: the microbes in our gut or in the soil of our favourite crops, are constantly evolving on a parasitism-mutualism continuum (see @fig-parmut). In this mini project, you will investigate the dynamics of microbiomes evolving on such a continuum. We will particularly focus on how the properties of the *host* (plant, animals, etc.) shape the likelihood of disease outbreaks. To that end, here are a few key questions to get you started, but you don't need to focus on each and every one of them at the same time. Plus, more (better!) questions will likely emerge as you work on the project. That's science.

## Key references

- @van2019role: a model of self-sacrificing microbes in hosts with different transmission modes.
- @koskella2020study: an opinion piece on host-microbe (co)evolution and levels of selection

## Guiding questions:

 * Do motile hosts (e.g. animals) experience different disease pressures than non-motile hosts (e.g. plants)?
 * Are mutualistic microbes easier to maintain in short- or long-lived hosts?
 * Does non-local reproduction (e.g. seed/spore dispersal) change these patterns?
 * How does an adaptive immune system (animals) affect the evolution of microbiomes, compared to plants, who don't have an adaptive immune system?

## Getting started

Maintaining self-sacrificial microbiomes isn't easy, as shown by the work of @van2019role. They show that the evolution of self-sacrificing microbes (which they call "helpers") is highly sensitive to the host's longevity and transmission of microbes in between hosts (horizontal transmission). To understand why, start by reading their paper. If you have read it, unfold the text below to see my summary of their methods.

::: {.callout-note collapse="true"}
## My summary of the model by van Vliet et al.

This model studies the maintanance of self-sacrificial "helper" microbes. Here, I will refer to helpers as "allies" (A), as to clearly differentiate it from "hosts" (H). Microbes that are not allies are referred to as neutral (N).

Allies provide a benefit to their host, while neutral microbes do not. The microbes are modelled with simple ordinary differential equations (ODEs):

$$
\begin{aligned}
\color{#555}{
\frac{dN}{dt} =
\underbrace{rN}_{\textrm{Growth N}} -
\underbrace{\delta N(A+N)}_{\textrm{Density-dependent death}}
}\\
\color{green}{
  \frac{dA}{dt} =
  \underbrace{rA(1-\gamma)}_{\textrm{Growth A}} -
  \underbrace{\delta A(A+N)}_{\textrm{Density-dependent death}}
}\\
\end{aligned}
\tag{1}
$$
As you can see, allies grow slower than neutral microbes and are therefore at a competitive disadvantage, and will eventually be outcompeted. To counter-act the loss of allies, van Vliet's model considers selection at the level of the host. To achieve this, the birth rate of hosts ($B_i$) depends on the frequency of allies A in the microbiome:

$$
B_i = \frac{r}{G_H}(1+s_b\cdot \frac{A}{A+N})
$$

Here, $G_H$ is a parameter that scales the host generation time w.r.t. the growth rate of microbes ($r$), with $G_H \gg r$ ensuring hosts are long-lived compared to microbes. The term $s_b$ is the maximum benefit that hosts get from carrying the ally strain. 

The death rate of hosts ($D_i$) increases linearly with the density of hosts at any given time ($H(t)$), and is given by:

$$
D_i = \frac{r}{G_H} \frac{H(t)}{K_H}
$$

Where $H(t)$ gives the number of hosts at a given time, and $K_H$ denotes the basal carrying capacity in the absence of allies. Note that the true carrying capacity can be higher, as helpers increase the birth rate of hosts.

Whenever a host reproduces, the microbiome is transmitted vertically to their offspring. The frequency of allies in the offspring is sampled from a normal distribution with mean $f_A$:

$$
f_{offspring}  = \mathcal{N} (f_{A},\sigma^2),
\\\text{with } f_A = \frac{A}{A+N}
$$

To avoid negative ally frequencies, this number is truncated such that $0<A_{offspring}<1$. The total density in the newborn is set by another parameter $n_0$. The model by van Vliet also considers "horizontal" transmission of microbiomes, where $f_A$ is not the ally frequency in the parent, but the frequency of allies in the microbiome of a **random** individual.

So far so good with all the math. Now the simulation...

### The simulation loop

1.  The birth and death rates of all hosts is calculated

2.  Calculate the probability of a host-level event (birth/death) occurring

3.  If an event occurs, draw a random event proportional to its probability.

4.  Execute the event sampled in step 3

5.  Update all the microbiome ODEs. 

:::

To start the project, we will first replicate van Vliet's results in Python. As a guideline, use my model summary above. I am ready to help where needed, but at this point in the course your experience should go a long way! If the simulation works, see if you can reproduce the following two figures:

::: {layout-ncol=2 #fig-vliet fig-cap="Helper maintenance in hosts with different transmission modes"}
![Allies are maintained within a population of hosts (black line shows the average), despite each individual host (green thinner lines) constantly decreasing in ally types. This can be explained by selection at the level of the host. ](images/vliet1.png){#fig-vliet1}

![Allies are *not* maintained within a population of hosts (black line shows the average) when transmission of microbiomes is horizontal (in between random individuals).](images/vliet2.png){#fig-vliet2}
:::

## Extending the model 

Now that you have a working base-line model, let's extend it to address the questions we phrased earlier: how does mobility of the host affect the evolution of microbiomes, and what about non-locally reproducing fungi? How do these host-level traits affect the likelyhood of "disease" outbreaks? Note that so far, we have only discussed "helpers" and "neutral" microbes, but the same principles apply to pathogens but perhaps a little more extreme. For example, the microbes may evolve such high levels of nastiness, that hosts do not only replicate slower, but die. Think about ways to extend the model that allows you to tune these distinctions. 


